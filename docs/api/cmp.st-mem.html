<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>cmp.st-mem documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Cmp</span> <span class="project-version">0.22.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cmp</span></div></div></li><li class="depth-2 branch"><a href="cmp.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-2 branch"><a href="cmp.api-utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api-utils</span></div></a></li><li class="depth-2 branch"><a href="cmp.build.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>build</span></div></a></li><li class="depth-2 branch"><a href="cmp.cli.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cli</span></div></a></li><li class="depth-2 branch"><a href="cmp.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-2 branch"><a href="cmp.doc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>doc</span></div></a></li><li class="depth-2 branch"><a href="cmp.exchange.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>exchange</span></div></a></li><li class="depth-2 branch"><a href="cmp.lt-mem.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lt-mem</span></div></a></li><li class="depth-2 branch"><a href="cmp.resp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>resp</span></div></a></li><li class="depth-2 branch"><a href="cmp.server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>server</span></div></a></li><li class="depth-2 branch current"><a href="cmp.st-mem.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>st-mem</span></div></a></li><li class="depth-2 branch"><a href="cmp.st-utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>st-utils</span></div></a></li><li class="depth-2 branch"><a href="cmp.state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-2 branch"><a href="cmp.task.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>task</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ui</span></div></div></li><li class="depth-3 branch"><a href="cmp.ui.container.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>container</span></div></a></li><li class="depth-3 branch"><a href="cmp.ui.index.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>index</span></div></a></li><li class="depth-3 branch"><a href="cmp.ui.listener.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>listener</span></div></a></li><li class="depth-3 branch"><a href="cmp.ui.mp-meta.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mp-meta</span></div></a></li><li class="depth-3 branch"><a href="cmp.ui.setup.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>setup</span></div></a></li><li class="depth-3 branch"><a href="cmp.ui.task.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>task</span></div></a></li><li class="depth-3"><a href="cmp.ui.ws.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ws</span></div></a></li><li class="depth-2 branch"><a href="cmp.utils.html"><div class="inner"><span class="tree" style="top: -238px;"><span class="top" style="height: 247px;"></span><span class="bottom"></span></span><span>utils</span></div></a></li><li class="depth-2 branch"><a href="cmp.work.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>work</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>worker</span></div></div></li><li class="depth-3 branch"><a href="cmp.worker.ctrl-mp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ctrl-mp</span></div></a></li><li class="depth-3 branch"><a href="cmp.worker.devhub.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>devhub</span></div></a></li><li class="depth-3 branch"><a href="cmp.worker.devproxy.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>devproxy</span></div></a></li><li class="depth-3 branch"><a href="cmp.worker.gen-db-doc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>gen-db-doc</span></div></a></li><li class="depth-3 branch"><a href="cmp.worker.get-date.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-date</span></div></a></li><li class="depth-3 branch"><a href="cmp.worker.get-time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-time</span></div></a></li><li class="depth-3 branch"><a href="cmp.worker.message.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>message</span></div></a></li><li class="depth-3 branch"><a href="cmp.worker.read-exchange.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>read-exchange</span></div></a></li><li class="depth-3 branch"><a href="cmp.worker.replicate-db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>replicate-db</span></div></a></li><li class="depth-3 branch"><a href="cmp.worker.select.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>select</span></div></a></li><li class="depth-3 branch"><a href="cmp.worker.wait.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>wait</span></div></a></li><li class="depth-3"><a href="cmp.worker.write-exchange.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>write-exchange</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="cmp.st-mem.html#var-clean-register.21"><div class="inner"><span>clean-register!</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-clear.21"><div class="inner"><span>clear!</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-close-listener.21"><div class="inner"><span>close-listener!</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-conn"><div class="inner"><span>conn</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-db"><div class="inner"><span>db</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-de-register.21"><div class="inner"><span>de-register!</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-del-key.21"><div class="inner"><span>del-key!</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-del-keys.21"><div class="inner"><span>del-keys!</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-filter-keys-where-val"><div class="inner"><span>filter-keys-where-val</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-gen-listener"><div class="inner"><span>gen-listener</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-key-.3Ekeys"><div class="inner"><span>key-&gt;keys</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-key-.3Eval"><div class="inner"><span>key-&gt;val</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-keys-.3Evals"><div class="inner"><span>keys-&gt;vals</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-listeners"><div class="inner"><span>listeners</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-msg-.3Ekey"><div class="inner"><span>msg-&gt;key</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-mtp"><div class="inner"><span>mtp</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-pat-.3Ekeys"><div class="inner"><span>pat-&gt;keys</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-reg-key"><div class="inner"><span>reg-key</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-register.21"><div class="inner"><span>register!</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-registered.3F"><div class="inner"><span>registered?</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-set-same-val.21"><div class="inner"><span>set-same-val!</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-set-state.21"><div class="inner"><span>set-state!</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-set-val.21"><div class="inner"><span>set-val!</span></div></a></li><li class="depth-1"><a href="cmp.st-mem.html#var-subs-pat"><div class="inner"><span>subs-pat</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">cmp.st-mem</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-clean-register.21"><h3>clean-register!</h3><div class="usage"><code>(clean-register! mp-id)</code></div><div class="doc"><div class="markdown"><p>Closes and <code>de-registers!</code> all <code>listeners</code> belonging to <code>mp-id</code> .</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L234">view source</a></div></div><div class="public anchor" id="var-clear.21"><h3>clear!</h3><div class="usage"><code>(clear! x)</code></div><div class="doc"><div class="markdown"><p>Clears the key <code>x</code>. If <code>x</code> is a vector the function <code>stu/vec-&gt;key</code> is used for the conversion of <code>x</code> to a string.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L73">view source</a></div></div><div class="public anchor" id="var-close-listener.21"><h3>close-listener!</h3><div class="usage"><code>(close-listener! l)</code></div><div class="doc"><div class="markdown"><p>Closes the given listener generated by <a href="cmp.st-mem.html#var-gen-listener">gen-listener</a>.</p>
<p>Example:</p>
<pre><code class="clojure">;; generate
(def l (gen-listener "ref" "ctrl" msg-&gt;key))
;; close 
(close-listener! l)
</code></pre></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L171">view source</a></div></div><div class="public anchor" id="var-conn"><h3>conn</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L10">view source</a></div></div><div class="public anchor" id="var-db"><h3>db</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L11">view source</a></div></div><div class="public anchor" id="var-de-register.21"><h3>de-register!</h3><div class="usage"><code>(de-register! mp-id struct no func)</code><code>(de-register! mp-id struct no func level)</code></div><div class="doc"><div class="markdown"><p>De-registers the listener with the key <code>mp-id</code> in the <code>listeners</code> atom.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L220">view source</a></div></div><div class="public anchor" id="var-del-key.21"><h3>del-key!</h3><div class="usage"><code>(del-key! k)</code></div><div class="doc"><div class="markdown"><p>Delets the key <code>k</code>.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L63">view source</a></div></div><div class="public anchor" id="var-del-keys.21"><h3>del-keys!</h3><div class="usage"><code>(del-keys! ks)</code></div><div class="doc"><div class="markdown"><p>Deletes all given keys (<code>ks</code>).</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L68">view source</a></div></div><div class="public anchor" id="var-filter-keys-where-val"><h3>filter-keys-where-val</h3><div class="usage"><code>(filter-keys-where-val pat x)</code></div><div class="doc"><div class="markdown"><p>Returns a list of all keys belonging to the pattern <code>pat</code> where the value is equal to<code>x</code>.</p>
<p>Example:</p>
<pre><code class="clojure">(filter-keys-where-val "ref@definitions@*@class" "wait")
;; ("ref@definitions@0@class"
;; "ref@definitions@2@class"
;; "ref@definitions@1@class")
</code></pre></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L95">view source</a></div></div><div class="public anchor" id="var-gen-listener"><h3>gen-listener</h3><div class="usage"><code>(gen-listener mp-id l2 l3 l4 callback)</code></div><div class="doc"><div class="markdown"><p>Returns a listener for published keyspace notifications. Don’t forget to <a href="cmp.st-mem.html#var-close-listener.21">close-listener!</a></p>
<p>Example:</p>
<pre><code class="clojure">;; generate and close
(close-listener! (gen-listener "ref" "ctrl" msg-&gt;key))
</code></pre></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L156">view source</a></div></div><div class="public anchor" id="var-key-.3Ekeys"><h3>key-&gt;keys</h3><div class="usage"><code>(key-&gt;keys k)</code></div><div class="doc"><div class="markdown"><p>Get all keys matching <code>k*</code>.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L55">view source</a></div></div><div class="public anchor" id="var-key-.3Eval"><h3>key-&gt;val</h3><div class="usage"><code>(key-&gt;val k)</code></div><div class="doc"><div class="markdown"><p>Returns the value for the given key (<code>k</code>) and cast it to a clojure type.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L84">view source</a></div></div><div class="public anchor" id="var-keys-.3Evals"><h3>keys-&gt;vals</h3><div class="usage"><code>(keys-&gt;vals ks)</code></div><div class="doc"><div class="markdown"><p>Returns a vector of the <code>vals</code> behind the keys <code>ks</code>.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L90">view source</a></div></div><div class="public anchor" id="var-listeners"><h3>listeners</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L187">view source</a></div></div><div class="public anchor" id="var-msg-.3Ekey"><h3>msg-&gt;key</h3><div class="usage"><code>(msg-&gt;key [kind l1 l2 l3])</code></div><div class="doc"><div class="markdown"><p>Extracts the <code>key</code> from a published keyspace notification message (<code>pmessage</code>).</p>
<p>Example:</p>
<pre><code class="clojure">(def msg ["pmessage"
         "__keyspace@0*__:ref@*@*@ctrl*"
         "__keyspace@0__:ref@container@0@ctrl"
         "set"])
(st/msg-&gt;key msg)
;; "ref@container@0@ctrl"
</code></pre></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L113">view source</a></div></div><div class="public anchor" id="var-mtp"><h3>mtp</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L12">view source</a></div></div><div class="public anchor" id="var-pat-.3Ekeys"><h3>pat-&gt;keys</h3><div class="usage"><code>(pat-&gt;keys pat)</code></div><div class="doc"><div class="markdown"><p>Get all keys matching the given pattern <code>pat</code>.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L50">view source</a></div></div><div class="public anchor" id="var-reg-key"><h3>reg-key</h3><div class="usage"><code>(reg-key mp-id struct no func level)</code></div><div class="doc"><div class="markdown"><p>Generates a registration key for the listener atom. The <code>level</code> param allows to register more than one listener for one pattern.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L192">view source</a></div></div><div class="public anchor" id="var-register.21"><h3>register!</h3><div class="usage"><code>(register! mp-id struct no func cb!)</code><code>(register! mp-id struct no func cb! level)</code></div><div class="doc"><div class="markdown"><p>Generates and registers a listener under the key <code>mp-id</code> in the <code>listeners</code> atom. The cb! function dispatches depending on the result.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L205">view source</a></div></div><div class="public anchor" id="var-registered.3F"><h3>registered?</h3><div class="usage"><code>(registered? k)</code></div><div class="doc"><div class="markdown"><p>Checks if a <code>listener</code> is registered under the <code>listeners</code>-atom.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L199">view source</a></div></div><div class="public anchor" id="var-set-same-val.21"><h3>set-same-val!</h3><div class="usage"><code>(set-same-val! ks v)</code></div><div class="doc"><div class="markdown"><p>Sets the given <code>val</code> for all keys <code>ks</code> with the delay <code>mtp</code>.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L26">view source</a></div></div><div class="public anchor" id="var-set-state.21"><h3>set-state!</h3><div class="usage"><code>(set-state! k state msg)</code><code>(set-state! k state)</code></div><div class="doc"><div class="markdown"><p>Function is used by the workers to set state. An optional log message may be provided.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L34">view source</a></div></div><div class="public anchor" id="var-set-val.21"><h3>set-val!</h3><div class="usage"><code>(set-val! k v)</code></div><div class="doc"><div class="markdown"><p>Sets the value <code>v</code> for the key <code>k</code>.</p></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L17">view source</a></div></div><div class="public anchor" id="var-subs-pat"><h3>subs-pat</h3><div class="usage"><code>(subs-pat mp-id l2 l3 l4)</code></div><div class="doc"><div class="markdown"><p>Generates subscribe patterns which matches depending on:</p>
<p><strong>l2</strong></p>
<ul>
  <li><code>container</code></li>
  <li><code>definitions</code></li>
</ul>
<p><strong>l3</strong></p>
<ul>
  <li><code>0</code> … <code>n</code></li>
</ul>
<p><strong>l4</strong></p>
<ul>
  <li><code>ctrl</code></li>
  <li><code>state</code></li>
  <li><code>definition</code></li>
</ul></div></div><div class="src-link"><a href="https://github.com/wactbprot/cmp/blob/master/src/cmp/st_mem.clj#L132">view source</a></div></div></div></body></html>